# Домашнее задание к занятию 13 «Введение в мониторинг»


## Обязательные задания

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчётов, которые сохраняются на диск. 
Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

    Ответ: 
    - Метрики использования ресурсов (CPU usage, memory usage, disk usage) - так как для всего этого используется сервер и надо понимать что там происходит
    - Метрики сети и HTTP (HTTP metrics, network usage) так как используется соединение по HTTP
    - Метрики связанные с самим проектом (время выполнения задач и т.п) так как нужно понимать как работает само приложение

2. Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

    Ответ: Можно сделать ему специализированный дашбор куда будут выведены нужные ему показатели
    - Кол-во удачно выполненых задач
    - Время выполнения задач
    - Времяответа сервиса
    - Доступность сервиса
    - кол-во ошибок и тд.

3. Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики, в свою очередь, хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

    Ответ: Зависит от использования технологий, можно ELK, Grafa loki, docker logs, kuber logs 

4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов. 
Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. Он не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

    Ответ: возможно наличие ошибок 1хх и 3хх

5. Опишите основные плюсы и минусы pull и push систем мониторинга.

  - Push система плюсы
    + Простота настройки агентов- агенты настроены для отправки данных на заранее определенный адрес.
    + Реагирование в реальном времени- данные отправляются сразу после их появления
    + Прохождение межсетевых экранов- исходящие соединения часто проще настраивать, чем входящие, особенно через межсетевые экраны
 - Push система минусы
    + Управление потоком данны- центральный сервер должен обрабатывать поток данных от всех агентов
    + Надежность агентов- если агент не отправляет данные, они могут быть потеряны
    + Безопасность-  Могут возникнуть проблемы безопасности при разрешении исходящих соединений от агентов
 
 - Pull система плюсы
    + Централизованное управление: Центральный сервер контролирует частоту и время запросов, что упрощает управление.
    + Безопасность: Входящие запросы к агентам могут быть ограничены для определенных IP-адресов или сетей, что улучшает безопасность.
    + Масштабируемость: Легче масштабировать центральный сервер для опроса большого количества агентов.
    + Менее зависимы от агентов: Если агент выходит из строя, данные просто не будут собраны до следующего опроса, а не затеряются.

 - Pull система минусы 
    + Сложность настройки: Требуется настройка агентов и центрального сервера для взаимной связи.
    + Сетевые задержки: В больших распределенных системах могут возникать задержки при опросе агентов.
    + Проблемы с межсетевыми экранами: Трудности с настройкой межсетевых экранов для разрешения исходящих запросов от центрального сервера.

6. Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?

    - Prometheus - Push 
    - TICK - Pull 
    - Zabbix - гибрид
    - VictoriaMetrics - гибрид 
    - Nagios - Pull

7. Склонируйте себе [репозиторий](https://github.com/influxdata/sandbox/tree/master) и запустите TICK-стэк, 
используя технологии docker и docker-compose.

В виде решения на это упражнение приведите скриншот веб-интерфейса ПО chronograf (`http://localhost:8888`). 

P.S.: если при запуске некоторые контейнеры будут падать с ошибкой - проставьте им режим `Z`, например
`./data:/var/lib:Z`

![screenshot-1](https://github.com/zitrax1/devops-netology/blob/main/monitoring/img/TIK_1.jpg)

8. Перейдите в веб-интерфейс Chronograf (http://localhost:8888) и откройте вкладку Data explorer.
        
    - Нажмите на кнопку Add a query
    - Изучите вывод интерфейса и выберите БД telegraf.autogen
    - В `measurments` выберите cpu->host->telegraf-getting-started, а в `fields` выберите usage_system. Внизу появится график утилизации cpu.
    - Вверху вы можете увидеть запрос, аналогичный SQL-синтаксису. Поэкспериментируйте с запросом, попробуйте изменить группировку и интервал наблюдений.

Для выполнения задания приведите скриншот с отображением метрик утилизации cpu из веб-интерфейса.

![screenshot-1](https://github.com/zitrax1/devops-netology/blob/main/monitoring/img/TIK_2.jpg)

9. Изучите список [telegraf inputs](https://github.com/influxdata/telegraf/tree/master/plugins/inputs). 
Добавьте в конфигурацию telegraf следующий плагин - [docker](https://github.com/influxdata/telegraf/tree/master/plugins/inputs/docker):
```
[[inputs.docker]]
  endpoint = "unix:///var/run/docker.sock"
```

Дополнительно вам может потребоваться донастройка контейнера telegraf в `docker-compose.yml` дополнительного volume и 
режима privileged:
```
  telegraf:
    image: telegraf:1.4.0
    privileged: true
    volumes:
      - ./etc/telegraf.conf:/etc/telegraf/telegraf.conf:Z
      - /var/run/docker.sock:/var/run/docker.sock:Z
    links:
      - influxdb
    ports:
      - "8092:8092/udp"
      - "8094:8094"
      - "8125:8125/udp"
```

После настройке перезапустите telegraf, обновите веб интерфейс и приведите скриншотом список `measurments` в 
веб-интерфейсе базы telegraf.autogen . Там должны появиться метрики, связанные с docker.

![screenshot-1](https://github.com/zitrax1/devops-netology/blob/main/monitoring/img/TIK_3.jpg)
